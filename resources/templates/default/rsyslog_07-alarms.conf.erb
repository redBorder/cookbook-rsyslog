<% unless @ips %>
#Template for RFC5424 formatted logs
template(name="alarm-triggered" type="list") {
    constant(value="{")
      constant(value="\"raw_message\":\"")               property(name="rawmsg" format="json")
      constant(value="\",\"message\":\"")                property(name="msg" format="json")
      constant(value="\",\"pri\":\"")                    property(name="pri" format="json")
      constant(value="\",\"pri_text\":\"")               property(name="pri-text" format="json")
      constant(value="\",\"syslogfacility\":\"")         property(name="syslogfacility" format="json")
      constant(value="\",\"syslogfacility_text\":\"")    property(name="syslogfacility-text" format="json")
      constant(value="\",\"syslogseverity\":\"")         property(name="syslogseverity" format="json")
      constant(value="\",\"syslogseverity_text\":\"")    property(name="syslogseverity-text" format="json")
      constant(value="\",\"protocol_version\":\"")       property(name="protocol-version" format="json")
      constant(value="\",\"timestamp\":\"")              property(name="timegenerated" dateFormat="unixtimestamp")
      constant(value="\",\"hostname\":\"")               property(name="hostname" format="json")
      constant(value="\",\"fromhost_ip\":\"")            property(name="fromhost-ip" format="json")
      constant(value="\",\"app_name\":\"")               property(name="app-name" format="json")
      constant(value="\",\"procid\":\"")                 property(name="procid" format="json")
      constant(value="\",\"msgid\":\"")                  property(name="msgid" format="json")
      constant(value="\",\"incident_uuid\":\"")          property(name="$!incident_uuid" format="json")
      constant(value="\",\"incident_uri\":\"")           property(name="$!incident_uri" format="json")
      constant(value="\",\"incident_domain\":\"")        property(name="$!incident_domain" format="json")
      constant(value="\",\"sensor_name\":\"")            property(name="$!sensor_name" format="json")
      constant(value="\",\"sensor_uuid\":\"")            property(name="$!sensor_uuid" format="json")
      constant(value="\",\"alarm_id\":\"")               property(name="$!alarm_id" format="json")
      constant(value="\",\"alarm_severity\":\"")         property(name="$!alarm_severity" format="json")
      constant(value="\",\"alarm_name\":\"")             property(name="$!alarm_name" format="json")
      constant(value="\",\"alarm_product_type\":\"")     property(name="$!alarm_product_type" format="json")
      constant(value="\",\"alarm_condition\":\"")        property(name="$!alarm_condition" format="json")
      constant(value="\",\"wan_ip\":\"")                 property(name="$!wan_ip" format="json")
      constant(value="\",\"lan_ip\":\"")                 property(name="$!lan_ip" format="json")
      constant(value="\",\"client_mac\":\"")             property(name="$!client_mac" format="json")
      constant(value="\",\"source\":\"")                 property(name="$!source" format="json")
      constant(value="\",\"target\":\"")                 property(name="$!target" format="json")
      constant(value="\",\"wireless_station\":\"")       property(name="$!wireless_station" format="json")
      constant(value="\",\"ethdst\":\"")                 property(name="$!ethdst" format="json")
      constant(value="\",\"ethsrc\":\"")                 property(name="$!ethsrc" format="json")
      constant(value="\",\"service_provider\":\"")       property(name="$!service_provider" format="json")
      constant(value="\",\"service_provider_uuid\":\"")  property(name="$!service_provider_uuid" format="json")
      constant(value="\",\"deployment\":\"")             property(name="$!deployment" format="json")
      constant(value="\",\"deployment_uuid\":\"")        property(name="$!deployment_uuid" format="json")
      constant(value="\",\"namespace\":\"")              property(name="$!namespace" format="json")
      constant(value="\",\"namespace_uuid\":\"")         property(name="$!namespace_uuid" format="json")
      constant(value="\",\"organization\":\"")           property(name="$!organization" format="json")
      constant(value="\",\"organization_uuid\":\"")      property(name="$!organization_uuid" format="json")
      constant(value="\",\"market\":\"")                 property(name="$!market" format="json")
      constant(value="\",\"market_uuid\":\"")            property(name="$!market_uuid" format="json")
      constant(value="\",\"campus\":\"")                 property(name="$!campus" format="json")
      constant(value="\",\"campus_uuid\":\"")            property(name="$!campus_uuid" format="json")
      constant(value="\",\"building\":\"")               property(name="$!building" format="json")
      constant(value="\",\"building_uuid\":\"")          property(name="$!building_uuid" format="json")
      constant(value="\",\"floor\":\"")                  property(name="$!floor" format="json")
      constant(value="\",\"floor_uuid\":\"")             property(name="$!floor_uuid" format="json")
    constant(value="\"}")
}


if $fromhost-ip == '127.0.0.1' and $app-name == 'alarmsjobs' and $msgid == 'alarm-triggered' then {
    action(type="omkafka" topic="rb_vault" broker="<%= @kafka_server %>:9092" template="alarm-triggered")
    stop
}
<% end %>